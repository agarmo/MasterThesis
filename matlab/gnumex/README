SUMMARY OF GNUMEX USAGE

For more information see the detailed guidelines in [1]. They were written in
2004, but are still (2007) pretty much up-to-date. Gnumex enables mex files
for C, C++ and Fortran to be created with gcc, and subsequently called from
Matlab. For Fortran use see the accompanying file, readme-fortran.txt. The
following steps are involved:

CHOOSE EITHER MINGW OR CYGWIN as the gcc environment. It is recommended that
   MinGW be used because (A) Gnumex is not compatible with the most recent
   versions of Cygwin, and (B) mex dll files compiled with cygwin crash Matlab
   when reloaded. Both of these problems have been actual at least since 2004,
   and are discussed in [1]. It is also possible to use the mixture, where
   cygwin gcc is used with the -mno-cygwin switch (called cygwin-mingw in the
   Gnumex window). For this a current cygwin version should be used, and it
   probably does not crash Matlab. To use Fortran 95 one must install g95.

   TO INSTALL MINGW:
   Visit www.mingw.org. Select "Download" and then "Sourceforge File Release".
   (Currently: http://sourceforge.net/project/showfiles.php?group_id=2435).
   Dowload the "Automated MinGW Installer", run it and install at least the
   MinGW base tools and the g++ compiler (and g77 if you want Fortran).

   TO INSTALL OLD CYGWIN:
   As said above you need an older version of Cygwin. Visit the web page
   http://ptolemy.eecs.berkeley.edu/ptolemyII/ptII4.0/cygwin.htm, download
   cygwinDevel.exe (35.4Mb) and follow the instruction on the web page.

   TO INSTALL G95:
   Visit g95.org, download and run one of the "Self-extracting Windows x86"
   files. Choose to install in the MinGW folder and directory structure (usually
   c:\mingw --- gnumex assumes that g95 is in the bin directory of MinGW).

   TO INSTALL CURRENT CYGWIN:
   Visit www.cygwin.com and choose "install or update cygwin now". Be sure to
   install at least binutils, gcc-core, gcc-g++, and gcc-g77 for Fortran.

NOW RUN GNUMEX. Cd to the folder where Gnumex is installed and type "gnumex"
   at the Matlab prompt. This brings up a GUI-window. Make apropriate choices
   (see [1]) and select "Make opts".

   If easy switching between compilers (or other Gnumex options) is desired
   it may be easier to add the Gnumex folder to the Matlab search path and
   use Gnumex in batch mode. Issue "gnumex usage" for a quick help.

   This will ceate libraries of mex-, mx- and mat-functions ready to be called
   from C or Fortran programs (in Matlab 7.4 and later a preliminary step is
   the creation of .def-files in the Gnumex folder). Gnumex will also create a
   configuration file for the Matlab mex-command, called "options.bat" by
   default. The configuration file sets gcc to be the compiler, and a
   perl-script, linkmex.pl, that is part of Gnumex to be the linker. It also
   points to the libraries, and sets appropriate options for the compilation
   and linking.

   There are two sensible choices for the configuration file, in the Matlab
   "prefdir" folder (e.g. "C:\Documents and Settings\jonasson\Application
   Data\MathWorks\MATLAB\R2007a"; its location is returned by the Matlab
   prefdir command) or in the folder where the sources of the C (or Fortran)
   programs are.

WRITE A GATEWAY ROUTINE in C or Fortran which will be called from Matlab and
   calls the computational routines. The gateway routine must be named
   mexFunction. For details refer to the Matlab documentation (in the newest
   Matlabs the chapter is called "Calling C and Fortran Programs from
   Matlab").

TO CREATE MEX-FILES use the Matlab mex command. It will by default look for a
   config file named "mexopts.bat" in the current folder, and if not found
   there in the prefdir folder. One can also use a -f switch to point to a
   different config file. For details, see the Matlab documentation on "mex",
   and the link therein to "mex script switches" (note for instance that it is
   possible to override the default flags from Gnumex with commands such as
   "mex -c OPTIMFLAGS='$OPTIMFLAGS -o2 yprime.c" -- before version 7.3 or 7.2
   one must use # instead of =). Mex compiles and links C or Fortran programs
   and creates mex-files with the extension .mexw32 (.dll in Matlab 7.0 and
   earlier) callable from Matlab. With a -c switch, mex compiles only and
   creates files with extension .obj -- .obj files are valid inputs for
   subsequent mex-commands.

EXAMPLE C MEXING: To try out mex-file creation copy the file yprime.c from the
   Matlab examples folder to the current folder, compile it with mex and call
   yprime. After running Gnumex (for C) you can issue from the Matlab prompt:
       >> copyfile([matlabroot '\extern\examples\mex\yprime.c'])
       >> mex yprime.c
       >> yprime(1, 1:4)
   and should receive the answer yp = 2.0000  8.9685  4.0000  -1.0947.

ACCOMPANYING DOCUMENTATION AND EXAMPLE FILES:
   readme-fortran.txt  More details on Fortran mexing
   yprime77.f          A Fortran 77 example gateway routine
   yprimef.f           A Fortran 77 example computational routine for yprime77
   yprime95.f90        A Fortran 95 example program (gateway and module)
   mexinterface.f90    Interface to mex functions for g95
   mexinterface_c.f90  Interface to mex functions for gfortran
   powerit.f90         Another Fortran 95 example, demonstrating more features
   fengdemo.f          Example Fortran engine program
   changes.txt         Lists changes after Gnumex version 1.11
   README              This file

NEXT STEPS: The author is working on support for new compilers (including the
   Nag and the Intel Fortran 95 compilers).

REFERENCES
   [1] http://gnumex.sourceforge.net

Kristjan Jonasson, September 2007 (jonasson@hi.is)
